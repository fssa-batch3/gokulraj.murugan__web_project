<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../Assets/Css/Exchange.css">
    <title>Document</title>
</head>

<body>
    <div class="navigation">
        <div>
            <img src="../Assets/Images/Screenshot__74..png" width="90%" id="logo" alt="">
        </div>

        <ul>

            <li>
                <a href="./dashboard.html">
                    <span class="icon"><i class="fa-solid fa-house"></i></span>
                    <span class="title">Home</span>
                </a>
            </li>
            <li>
                <a href="./Exchange.html">
                    <span class="icon"><i class="fa-solid fa-arrows-rotate"></i></span>
                    <span class="title">Exchange</span>
                </a>
            </li>
            <li>
                <a href="./wallet.html">
                    <span class="icon"><i class="fa-solid fa-wallet"></i></span>
                    <span class="title">Wallet</span>
                </a>
            </li>
            <li>
                <a href="./cryptos.html">
                    <span class="icon"><i class="fa-solid fa-square-poll-vertical"></i></span>
                    <span class="title">Chart</span>
                </a>
            </li>
            <li>
                <a href="./profile.html">
                    <span class="icon"><i class="fa-solid fa-user"></i></span>
                    <span class="title">Profile</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <span class="icon"><i class="fa-solid fa-gear"></i></span>
                    <span class="title">Settings</span>
                </a>
            </li>
        </ul>
    </div>
    <div class="all">


        <div class="head">
            <h3><a href="./Exchange.html">Buy</a></h3>
            <button id="sell_button" type="button">Sell</button>
            <div>
                <input type="search" name="search" placeholder="Search" id="search">
            </div>
        </div>
        <hr class="line">

        <div class="main">

            <div class="exchagnes">
                <h2 class="crypto_name">Bitcoin</h2>
                <div data-id="bitcoin" class="cards">
                </div>
            </div>
            <div class="exchagnes">
                <h2 class="crypto_name">Tether</h2>
                <div data-id="tether" class="cards">
                </div>
            </div>
            <div class="exchagnes">
                <h2 class="crypto_name">Doge Coin</h2>
                <div data-id="dogecoin" class="cards">
                </div>
            </div>
            <div class="exchagnes">
                <h2 class="crypto_name">Solana</h2>
                <div data-id="solana" class="cards">
                </div>
            </div>
            <div class="exchagnes">
                <h2 class="crypto_name">Ethereum</h2>
                <div data-id="ethereum" class="cards">
                </div>
            </div>
            <div class="exchagnes">
                <h2 class="crypto_name">Lite Coin</h2>
                <div data-id="litecoin" class="cards">
                </div>
            </div>
            <div class="exchagnes">
                <h2 class="crypto_name">Binance</h2>
                <div data-id="binance" class="cards">
                </div>
            </div>
            <div class="exchagnes">
                <h2 class="crypto_name">Cardano</h2>
                <div data-id="cardano" class="cards">
                </div>
            </div>







            <!-- pop up -->
            <div id="overlay"></div>
            <div class="popup">

                <div><a href="#"><i class="fa-solid fa-xmark" id="close-btn"></i></a>
                </div>
                <form>
                    <label for="cryoto_name2">Coin Name :</label>
                    <input type="text" name="cryoto_name2" id="crypto_name2" required><br>

                    <label for="crypto">How many coins :</label>
                    <input type="number" name="crypto" id="no_of_coins" required><br>

                    <label for="money">Money :</label>
                    <input type="number" name="money" id="money" required><br>
                </form>
                <button id="sell">Sell</button>
            </div>









        </div>
        <script src="https://kit.fontawesome.com/ee40c53027.js" crossorigin="anonymous" integrity="">
        </script>
        <!-- <script src="../Assets/js/exchange.js"></script> -->


        <script>

            let user_id;
            let profile_image;
            let username;
            let login = JSON.parse(localStorage.getItem("login"));
            let user_detail = JSON.parse(localStorage.getItem("Userdata"));
            let value;

            user_detail.find(e => {
                if (e["email"] == login["email"]) {
                    value = e;
                }
            })
            console.log(value)
            user_id = value["User_id"];
            username = value["Username"]
            profile_image = value["profile_pic"]

            console.log(user_id)



            // Product Create starts
            function product_details() {
                let product_id = Math.floor(Math.random() * 100)
                let crypto_name2 = document.getElementById("crypto_name2").value.toLowerCase();
                let no_of_coins = document.getElementById("no_of_coins").value;
                let money = document.getElementById("money").value;
                // console.log(crypto_name2.toLowerCase())
                console.log(crypto)
                let res;
                let product_details = JSON.parse(localStorage.getItem("product_details")) ?? [];



                let product = {
                    "user_id": user_id,
                    "product_id": product_id,
                    "crypto_name": crypto_name2,
                    "username": username,
                    "no_of_coins": no_of_coins,
                    "money": money,
                    "profile_pic": profile_image,

                }


                product_details.push(product)
                localStorage.setItem("product_details", JSON.stringify(product_details))
                window.location.href = "exchange.html"
            }

            let check = document.getElementById("sell");
            check.addEventListener("click", e => {
                e.preventDefault()
                product_details()
            })
            // Product Create ends







            // Product Read starts
            product_detail = JSON.parse(localStorage.getItem("product_details"))
            // console.log(product_detail)
            if (product_detail == null) {

            }
            else {



                for (let i = 0; i < product_detail.length; i++) {

                    // <div class="onecard">
                    let onecard = document.createElement("div")
                    onecard.setAttribute("class", "onecard")
                    let crypto_data = document.querySelectorAll(".cards");

                    crypto_data.forEach((e) => {
                        if (e.dataset.id == product_detail[i]["crypto_name"]) {
                            // console.log("matched")
                            e.prepend(onecard)
                        }
                        // console.log(e.dataset.id)
                    })

                    // <div class="profile">
                    let profile = document.createElement("div")
                    profile.setAttribute("class", "profile")
                    onecard.append(profile)

                    // <img src="../Assets/Images/profile.png" class="user_photo" alt="">
                    let user_photo = document.createElement("img")
                    user_photo.setAttribute("src", product_detail[i]["profile_pic"])
                    user_photo.setAttribute("class", "user_photo")
                    user_photo.setAttribute("alt", "error_found")
                    profile.append(user_photo)

                    // <div class="coin_details">
                    let coin_details = document.createElement("div")
                    coin_details.setAttribute("class", "coin_details")
                    profile.append(coin_details)

                    // <div class="coin_details2">
                    let coin_details2 = document.createElement("div")
                    coin_details2.setAttribute("class", "coin_details2")
                    coin_details.append(coin_details2)


                    // <img src="../Assets/Images/Logo/btc.png" width="12%" alt="" class="crypto_image">
                    let crypto_image = document.createElement("img")
                    crypto_image.setAttribute("src", "../Assets/Images/Logo/btc.png")
                    crypto_image.setAttribute("class", "crypto_image")
                    crypto_image.setAttribute("alt", "error_found")
                    crypto_image.setAttribute("width", "12")
                    coin_details2.append(crypto_image)


                    //  <h4 class="crypto_name2">Bitcoin</h4>
                    let cryoto_name2 = document.createElement("h4")
                    cryoto_name2.setAttribute("class", "cryoto_name2")
                    cryoto_name2.innerText = product_detail[i]["crypto_name"]
                    coin_details2.append(cryoto_name2)

                    // <h4 class="username">Username</h4>
                    let username = document.createElement("h4")
                    username.setAttribute("class", "username")
                    username.innerText = product_detail[i]["username"]
                    coin_details.append(username)

                    // <div class="exchange">
                    let exchange = document.createElement("div")
                    exchange.setAttribute("class", "exchange")
                    onecard.append(exchange)

                    // <input type="number" name="crypto" id="crypto" disabled>
                    let crypto = document.createElement("input")
                    crypto.setAttribute("type", "number")
                    crypto.setAttribute("name", "crypto")
                    crypto.setAttribute("id", "crypto")
                    crypto.setAttribute("disabled", "")
                    crypto.setAttribute("value", product_detail[i]["no_of_coins"])
                    crypto
                    exchange.append(crypto)

                    // <br>
                    let space = document.createElement("br")
                    exchange.append(space)


                    // <input type="number" name="price" id="price" disabled>
                    let price = document.createElement("input")
                    price.setAttribute("type", "number")
                    price.setAttribute("name", "price")
                    price.setAttribute("id", "price")
                    price.setAttribute("disabled", "")
                    price.value = product_detail[i]["money"]
                    exchange.append(price)

                    // <br>
                    let space2 = document.createElement("br")
                    exchange.append(space2)


                    if (login["user_id"] === product_detail[i]["User_id"]) {
                        // buy_button.style.display = "none"
                    }
                    else {
                        // <button class="buttons">Buy</button>
                        let buy_button = document.createElement("button")
                        buy_button.setAttribute("class", "buttons2")
                        buy_button.setAttribute("value", product_detail[i]["product_id"])
                        buy_button.innerText = "Buy"
                        exchange.append(buy_button)
                    }




                }
            }




            // Product Read ends



            // Pop up starts
            let sell_button = document.getElementById("sell_button")
            let overlay = document.querySelector('#overlay');
            let popup = document.querySelector('.popup');
            let closebtn = document.getElementById('close-btn');
            let edit_popup = document.querySelector(".popup_edit")
            let save = document.getElementById("save")




            function openPopup() {
                popup.style.display = 'block';
                overlay.style.display = 'block';
            }

            function closePopup() {
                popup.style.display = 'none';
                overlay.style.display = 'none';
            }

            closebtn.addEventListener("click", closePopup);
            sell_button.addEventListener("click", openPopup);

            // Pop up ends


            // payment details create

            let payment_id = document.querySelectorAll(".buttons2")
            let product_Id;
            let res;

            // time code starts

            const now = new Date();
            let hours = now.getHours();
            let minutes = now.getMinutes();
            let amPm = hours < 12 ? 'am' : 'pm';

            // Convert from 24-hour to 12-hour format
            hours = hours % 12;
            hours = hours ? hours : 12;

            // Add leading zero to minutes if necessary
            minutes = minutes < 10 ? '0' + minutes : minutes;

            let currentTime = `${hours}.${minutes} ${amPm}`;
            // time code ends



            payment_id.forEach((data) => {
                data.addEventListener("click", () => {
                    product_Id = data.value
                    // console.log(product_Id);

                    product_detail.find((element) => {
                        if (product_Id == element["product_id"]) {
                            res = element
                            // console.log(res);
                            alert("are you sure you want to buy??")
                            payment_detail()
                        }
                    })
                })

                function payment_detail() {
                    let store_data = JSON.parse(localStorage.getItem("payment_details")) ?? [];
                    let order_id = Math.floor(Math.random() * 100);
                    console.log(res)


                    let payment_details = {
                        "profile_pic": res["profile_pic"],
                        "order_id": order_id,
                        "user_id": login.user_id,
                        "product_id": product_Id,
                        "crypto_name": res["crypto_name"],
                        "no_of_coins": res["no_of_coins"],
                        "money": res["money"],
                        "username": res["username"],
                        "time": currentTime,
                        "type": "Buy",
                    }

                    // console.log(payment_details)
                    store_data.push(payment_details)
                    localStorage.setItem("payment_details", JSON.stringify(store_data))
                    window.location.href = "./selectpayment.html"

                }
            });
        </script>

</body>

</html>